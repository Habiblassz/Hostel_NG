generator client {
 provider = "prisma-client-js"
}

datasource db {
 provider = "sqlite"
 url      = "file:./dev.db"
}

model User {
 id               String   @id @default(cuid())
 email            String   @unique
 name             String
 password         String
 role             String
 avatar           String?
 phone            String?
 emergencyContact String?
 address          String?
 status           String   @default("ACTIVE")
 createdAt        DateTime @default(now())
 updatedAt        DateTime @updatedAt

 // Relations
 student       Student?
 staff         Staff?
 issuedCards   AccessCard[]
 posts         Post[]
 notifications Notification[]

 @@map("users")
}

model Student {
 id              String  @id @default(cuid())
 studentId       String  @unique
 userId          String  @unique
 currentHostelId String?
 roomNumber      String?

 // Relations
 user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
 hostel       Hostel?       @relation(fields: [currentHostelId], references: [id])
 roomRequests RoomRequest[]
 accessCards  AccessCard[]

 @@map("students")
}

model Staff {
 id         String   @id @default(cuid())
 userId     String   @unique
 department String
 position   String
 joinDate   DateTime

 // Relations
 user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)
 assignedRequests RoomRequest[]

 @@map("staff")
}

model Hostel {
 id             String   @id @default(cuid())
 name           String
 description    String?
 totalRooms     Int
 availableRooms Int
 status         String   @default("ACTIVE")
 createdAt      DateTime @default(now())

 // Relations
 students     Student[]
 rooms        Room[]
 roomRequests RoomRequest[]
 accessCards  AccessCard[]

 @@map("hostels")
}

model Room {
 id               String  @id @default(cuid())
 hostelId         String
 roomNumber       String
 roomType         String
 capacity         Int
 currentOccupancy Int     @default(0)
 status           String  @default("AVAILABLE")
 price            Float?
 amenities        String?

 // Relations
 hostel           Hostel        @relation(fields: [hostelId], references: [id], onDelete: Cascade)
 assignedRequests RoomRequest[]
 accessCards      AccessCard[]

 @@unique([hostelId, roomNumber])
 @@map("rooms")
}

model RoomRequest {
 id              String    @id @default(cuid())
 studentId       String
 hostelId        String
 roomType        String
 sessionDuration String
 status          String    @default("PENDING")
 assignedRoomId  String?
 assignedStaffId String?
 adminNotes      String?
 submittedAt     DateTime  @default(now())
 processedAt     DateTime?

 // Relations
 student       Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
 hostel        Hostel  @relation(fields: [hostelId], references: [id])
 assignedRoom  Room?   @relation(fields: [assignedRoomId], references: [id])
 assignedStaff Staff?  @relation(fields: [assignedStaffId], references: [id])

 @@map("room_requests")
}

model AccessCard {
 id          String   @id @default(cuid())
 studentId   String
 hostelId    String
 roomId      String
 qrCodeUrl   String
 expiryDate  DateTime
 status      String   @default("ACTIVE")
 issuedById  String
 issuedAt    DateTime @default(now())
 lastUpdated DateTime @updatedAt

 // Relations
 student  Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
 hostel   Hostel  @relation(fields: [hostelId], references: [id])
 room     Room    @relation(fields: [roomId], references: [id])
 issuedBy User    @relation(fields: [issuedById], references: [id])

 @@map("access_cards")
}

model Post {
 id             String   @id @default(cuid())
 title          String
 category       String
 content        String
 imageUrl       String?
 authorId       String
 targetAudience String   @default("ALL")
 isPublished    Boolean  @default(true)
 createdAt      DateTime @default(now())
 updatedAt      DateTime @updatedAt

 // Relations
 author User @relation(fields: [authorId], references: [id])

 @@map("posts")
}

model Notification {
 id                String   @id @default(cuid())
 userId            String
 title             String
 message           String
 type              String
 relatedEntityType String?
 relatedEntityId   String?
 isRead            Boolean  @default(false)
 createdAt         DateTime @default(now())

 // Relations
 user User @relation(fields: [userId], references: [id], onDelete: Cascade)

 @@map("notifications")
}
